# 싱글톤 패턴

스프링은 기본적으로 기업 상대를 위한 서비스이다
웹은 여러 고객의 동시적 요청을 상대해야한다.
하나의 클래스를 여러명이 요청해대면 그 수 만큼 객체가 생성되는데 이게 문제다

- 해당 객체&인스턴스를 딱 1개만 생성되게 하는것이 싱글톤! 
- 생성 된 객체만을 공유해서 쓰게 하자 -> private 으로 new 생성자 막기.


- 단점: 구현하는 코드가 좀 많이 들어간다.
- DIP 위반한다.
- OCP 원칙 위반 가능성이 높다.
- 테스트 하기 어렵다.
- private 생성자로 자식 클래스 만들기 어렵다
- 내부 변경이나 초기화가 어려움.

-> 이 단점을 스프링 컨테이너는 다 해결하고 사용한다.

## 주의
- 싱글톤 객체는 상태를 유지하게 설계하면 안된다
    - 특정 클라이언트에 의존적인 필드가 있으면 안됨.
    - 특정 클라이언트가 값을 변경할 수 있는 필드가 있으면 안됨.
    - 읽기만 가능한게 좋다.
    - 지역변수,파라미터,TreadLocal등을 사용해야 한다.

# Configuration

AppConfig 에 설정된 @Configuration의 역할 확인하기
- ConfigurationSingletonTest 파일에서 MemberRepository 를 3번 호출하지만 같은 참조값이 나오는걸 볼 수 있다.
- 이건 Configuration을 쓴 AppConfig 클래스 파일을 디버깅해보면 알 수 있다.
- 출력 시 class com.hello.core.section2and3.AppConfig 뒤에 $$가 붙는걸 볼 수 있다.
- 이건 SpringCGLIB 라는 라이브러리에서 AppConfig 를 상속받은 임의의 인스턴스를 생성해서 만들어낸다.
- 따라서 Bean 이 붙으면 그대로 반환하고 없으면 생성해서 Bean으로 등록하고 반환한다.

## if
### Configuration 이 없다면?
- AppConfig 를 출력하면 CGLIB 가 아닌 본연의 Class 가 출력됨.
- @Bean 을 통해 등록은 제대로 됨.
- 싱글톤 패턴이 깨지면서 호출 요청만큼 그대로 호출함. 
  